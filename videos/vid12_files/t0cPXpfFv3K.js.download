;/*FB_PKG_DELIM*/

__d("WAWebPipMsgVideoTag.react",["WAWebFrontendMsgGetters","WAWebMediaOpaqueData","WAWebMsgGetters","WAWebNewsletterGatingUtils","WAWebPipUrlVideoTagLoadable.react","WAWebPipVideoStreaming","WAWebUserPrefsGeneral","react","useMergeRefs","useWAWebCometVideoPlayerStateMachine","useWAWebModelValues","useWAWebMsgValues","useWAWebOnUnmount","useWAWebStableCallback"],(function(a,b,c,d,e,f,g){var h=["ref"],i,j;b=j||d("react");var k=i||(i=c("react")),l=b.useCallback,m=b.useEffect,n=b.useRef;function a(a){var b,e=a.ref;a=babelHelpers.objectWithoutPropertiesLoose(a,h);var f=a.onLoadedMetadata,g=d("useWAWebMsgValues").useMsgValues(a.msg.id,[d("WAWebMsgGetters").getId]);g=g[0];var i=d("useWAWebModelValues").useModelValues(a.mediaData,["mediaBlob","streamable","aspectRatio"]),j=n(null),o=c("useMergeRefs")(e,j);e=d("WAWebFrontendMsgGetters").getChat(a.msg).id.toString().replace(/@.*/,"");b=(b=a.msg.serverId)!=null?b:"";e=e+"_"+b;b=a.msg.getWamMessageType();b=c("useWAWebCometVideoPlayerStateMachine")({mediaId:d("WAWebNewsletterGatingUtils").getNewsletterLoggingMediaID(),isCopyrightMuted:!1,videoOrigin:b,mediaIdString:e});e=b.callbacks;var p=b.videoElementRefCallback,q=b.handleReactEffectCleanup,r=b.handleReactEffectInit;b=n(Boolean(i.mediaBlob));m(function(){r()},[r]);c("useWAWebOnUnmount")(function(){q()});var s=c("useWAWebStableCallback")(function(a){if(j.current===a)return;var b=a==null?void 0:a.underlyingVideo();b!=null&&p(b);o(a);if(a){b=d("WAWebUserPrefsGeneral").getMediaVolumeSettings();var c=b.volume;b=b.muted;c!=null&&a.setVolume(c);a.setMuted(b)}}),t=l(function(a,b){var c=i.aspectRatio,d=a.videoWidth!==0&&a.videoHeight!==0?a.videoWidth/a.videoHeight:void 0;(!c&&d!=null&&d!==0||c&&d!=null&&d!==0&&Math.abs(d-c)>.01)&&i.set({aspectRatio:d});f(a,b)},[i,f]),u=i.mediaBlob,v=i.streamable&&i.isStreamable();(b.current||!v)&&u instanceof c("WAWebMediaOpaqueData")?b=u.url():i.streamable&&i.isStreamable()?b=d("WAWebPipVideoStreaming").VIDEO_STREAM_URL+"?key="+g.toString():b=void 0;return k.jsx(d("WAWebPipUrlVideoTagLoadable.react").UrlVideoTagLoadable,{msg:a.msg,ref:s,url:b,startTime:a.startTime,poster:a.poster,className:a.className,onVolumeChange:a.onVolumeChange,onEnded:a.onEnded,onError:a.onError,onPause:a.onPause,onPlaying:a.onPlaying,onProgress:a.onProgress,onTimeUpdate:a.onTimeUpdate,onLoadedMetadata:t,autoPlay:a.autoPlay,onCanPlay:a.onCanPlay,onLoadedData:a.onLoadedData,onWaiting:a.onWaiting,callbacks:e,children:a.children})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);